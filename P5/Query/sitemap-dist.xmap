<?xml version="1.0" encoding="UTF-8"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
  
  <!-- =========================== Components ================================ -->
  
  <map:components>
    <map:generators default="file">
      <map:generator name="xquery" logger="sitemap.generator.xquery"
		     src="org.exist.cocoon.XQueryGenerator"/>
    </map:generators>
    <map:readers default="resource"/>
    <map:serializers default="html"/>
    <map:selectors default="browser"/>
    <map:matchers default="wildcard"/>
    <map:transformers default="xslt">
    </map:transformers>
    <map:selectors default="request">
      <map:selector name="request"
		    src="org.apache.cocoon.selection.RequestSelector"/>
    </map:selectors>

  </map:components>
  
  <!-- =========================== Pipelines
       ================================= -->
  
  <map:pipelines>		
    <map:pipeline>	
      
      <map:match pattern="tag.xq">
	<map:select type="request">
	  <map:parameter name="parameter-name" value="style"/>
	  <map:when test="tei">
	    <map:generate src="tag.xq" type="xquery"/>
	    <map:serialize encoding="UTF-8" type="xml"/> 
	  </map:when>
	  <map:otherwise>
	    <map:generate src="tag.xq" type="xquery"/>
	    <map:transform type="xinclude"/>
             <map:transform 
		src="file:///usr/share/xml/tei/stylesheet/teic/odd2htmlfragment.xsl">
 		<map:parameter name="use-request-parameters" value="true"/>
		<map:parameter name="TEISERVER" value="http://tei.oucs.ox.ac.uk/Query/"/>
	    </map:transform>
	    <map:serialize encoding="UTF-8" type="html"/> 
	  </map:otherwise>
	</map:select>
      </map:match> 

     <map:match pattern="class.xq">
	<map:generate src="class.xq" type="xquery"/>
	<map:transform type="xinclude"/>
	<map:transform 
	 src="file:///usr/share/xml/tei/stylesheet/teic/odd2htmlfragment.xsl"/>
	<map:serialize encoding="UTF-8" type="html"/> 
      </map:match> 

      <map:match pattern="*.xq">
	<map:generate src="{1}.xq" type="xquery"/>
	<map:transform type="xinclude"/>
<!--	<map:transform 
	 src="file:///usr/share/xml/tei/stylesheet/teic/teihtml-teic.xsl"/>
	<map:transform type="encodeURL"/>
	-->
	<map:serialize encoding="UTF-8" type="xml"/>
      </map:match>


    </map:pipeline>
  </map:pipelines>	
  
</map:sitemap>
