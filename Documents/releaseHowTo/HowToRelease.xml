<?xml version="1.0"?>
<!--
$LastChangedDate: 2010-04-10$.
$LastChangedBy: jamesc$
$LastChangedRevision$
-->
<TEI   xmlns="http://www.tei-c.org/ns/1.0">
  <teiHeader> 
    <fileDesc> 
      <titleStmt>
	<title>Maintaining the TEI</title>
	<author>Sebastian Rahtz</author>
      </titleStmt>
      <editionStmt>
	<edition>
	  <date>February 2011</date>
	</edition>
      </editionStmt>
      <publicationStmt> 
	<p> For the TEI Website</p> 
      </publicationStmt> 
      <sourceDesc> 
	<p>Derived from lots of other talks</p> 
      </sourceDesc> 
    </fileDesc>
  </teiHeader>
  <text>
    <body>
<p>The purpose of this guide is to explain the steps that need to be
taken when changes are made to the TEI P5 sources.</p>
<div xml:id="svn">
<head>Building the release</head>
<p>You will always start from the packages on Sourceforge, managed using Subversion. These are
<list type="gloss">
<label>I18N</label><item>Input to I18N utilities. Not published</item>
<label>P5</label><item>The main TEI P5 source</item>
<label>Roma</label><item>The web application</item>
<label>Stylesheets</label><item>Base stylesheets</item>
<label>TEIOO</label><item>Support for TEI and Open Office. Not published</item>
<label>tei-emacs</label><item></item>
</list>
The rest of this documents assumes that we are dealing with the main
<ident>P5</ident> package, and that you are on a Linux or MacOSX system with a
command line, and know (more or less) how to use the <q>make</q> utility.
The same instructions apply, <foreign>mutatis mutandis</foreign>, to the packages
for Roma and Stylesheets.</p>

<p>First edit the file <ident>VERSION</ident>, and make it say what
you are about to release. Now check that the source is clean and tested. 
When you are happy that these are what you want,
do <code>make dist</code>. This makes a single zip file
with all the TEI P5 deliverables in, called <code>tei-</code><emph>versionumber</emph><code>.zip</code>.</p>

<p>If you also say <code>make deb</code>, and you have the Debian devscripts packages installed,
six Debian packages will be created.</p>

<p>If you do not have a build system yourself, the Jenkins CI server
(currently experimentally at <ptr
target="http://tei.oucs.ox.ac.uk/jenkins"/>) will watch Subversion,
make all the tests, and rebuild everything after any change. It will
create the zip archive and Debian packages for you.</p>
</div>

<div xml:id="sf">
<head>Uploading file releases to Sourceforge</head>
<p>The zip file <code>tei-</code><emph>versionumber</emph><code>.zip</code>
is what we put up on Sourceforge. If you have not created it youself, grab
from <ptr target="http://tei.oucs.ox.ac.uk/jenkins/job/TEIP5-Release/lastSuccessfulBuild/artifact/tei-1.9.0.zip"/>.
You will now need to put this in the Sourceforge download area by using one 
of the supported methods to upload the file. I do (eg)
<eg>
rsync -e ssh tei-1.9.0.zip rahtz,tei@frs.sourceforge.net:/home/frs/project/t/te/tei/TEIP5-All
</eg>
the details are at <ptr target="https://sourceforge.net/apps/trac/sourceforge/wiki/Release%20files%20for%20download"/>
</p>
</div>

<div xml:id="debian">
<head>Making Debian packages</head>
<p>You make a Debian package
by combining a set of source files with Debian-specific metadata and
support files. For each of the 
6 packages described above, there is a directory under P5 named
<code>debian-<emph>packagename</emph></code>
inside which is a directory called <code>debian</code> containing the
necessary added material. The make target <code>deb</code> goes into
each of the directories and builds the package, creating 6 corresponding .deb, .build and .changes
files. As above, if you cannot build these yourself, grab from 
<ptr target="http://tei.oucs.ox.ac.uk/jenkins/job/TEIP5-Release/lastSuccessfulBuild/artifact/"/></p>

<p>Now you can move the Debian files to a repository somewhere (tei.oucs.ox.ac.uk:/home/tei/teideb,
if you have access) and rebuild
the package database. There are plenty of potential slips 'twixt cup and lip here.
Building Debian packages is extensively documented on the web, but
there is a lot more to it than I describe here (such as the content of
the control files for post-installation, pre-removal, init scripts,
menus etc).</p>

<p>The important TEI-related Debian packages are
<list type="gloss">
<label>tei-emacs</label><item>TEI Emacs setup</item>
<label>tei-oxygen</label><item>oXygen XML editor</item>
<label>tei-p4-doc</label><item>TEI Guidelines (P4)</item>
<label>tei-p4-lite</label><item>TEI P4 Lite</item>
<label>tei-p4-schema</label><item>TEI P4 Schemas/DTDs</item>
<label>tei-p4-xsl</label><item>TEI P4 XSLT stylesheets </item>
<label>tei-p5-doc</label><item>TEI Guidelines</item>
<label>tei-p5-exemplars</label><item>TEI exemplar customiza</item>
<label>tei-p5-schema</label><item>TEI Schemas/DTDs</item>
<label>tei-p5-source</label><item>TEI sources/DTDs</item>
<label>tei-p5-test</label><item>TEI test files</item>
<label>tei-p5-xsl</label><item>TEI XSLT (1.0) stylesheets</item>
<label>tei-p5-xsl2</label><item>TEI XSLT (2.0) stylesheets</item>
<label>tei-xsl-common</label><item>TEI XSLT stylesheets, shared files</item>
</list>
Some of these will require other packages, which will get pulled in as
needed (trang, jing etc).</p>
</div>

<div xml:id="web">
<head>Installing files on the TEI web site</head>
<p>People wanting to download bundles should always be sent to SF,
so the point of having dtds, schemas and stylesheets on the web site(s) is 
<list>
<item>to service the rendering web pages themselves</item>
<item>to let Roma find resources</item>
<item>to provide a service of fixed URLs for DTDs and schemas</item>
</list>
Currently, this means the population of the <code>/usr/share/xml/tei</code> and
<code>/usr/share/doc/tei-*</code> directories:
<eg>
tei
|-- Test
|-- custom
|   |-- odd
|   |-- schema
|   |   |-- dtd
|   |   |-- relaxng
|   |   `-- xsd
|   `-- templates
|-- odd
|   |-- Exemplars
|   |-- ReleaseNotes
|   |-- Source
|   |   |-- Guidelines
|   |   |   |-- en
|   |   |   |   `-- Images
|   |   |   `-- fr
|   |   |       `-- Images
|   |   |-- Images
|   |   `-- Specs
|   |       |-- 18decembre
|   |       `-- exemples
|   |-- Utilities
|   `-- webnav
|       `-- icons
|-- schema
|   |-- dtd
|   `-- relaxng
|-- stylesheet
|   |-- common
|   |-- common2
|   |-- docx
|   |   |-- from
|   |   |   |-- dynamic
|   |   |   |   `-- tests
|   |   |   |       `-- xspec
|   |   |   |-- graphics
|   |   |   |-- lists
|   |   |   |-- marginals
|   |   |   |-- maths
|   |   |   |-- paragraphs
|   |   |   |-- pass0
|   |   |   |-- pass2
|   |   |   |-- tables
|   |   |   |-- templates
|   |   |   |-- textruns
|   |   |   |-- utils
|   |   |   `-- wordsections
|   |   |-- misc
|   |   |-- to
|   |   |   |-- docxfiles
|   |   |   |-- drama
|   |   |   |-- dynamic
|   |   |   |-- graphics
|   |   |   |-- lists
|   |   |   |-- maths
|   |   |   |-- templates
|   |   |   `-- wordsections
|   |   `-- utils
|   |       |-- graphics
|   |       |-- identity
|   |       |-- maths
|   |       `-- verbatim
|   |-- epub
|   |-- fo
|   |-- fo2
|   |-- html
|   |-- latex
|   |-- latex2
|   |-- nlm
|   |-- odds
|   |-- odds2
|   |-- oo
|   |-- profiles
|   |   |-- bodley
|   |   |   `-- epub
|   |   |-- default
|   |   |   |-- csv
|   |   |   |-- docbook
|   |   |   |-- docx
|   |   |   |-- dtd
|   |   |   |-- epub
|   |   |   |-- fo
|   |   |   |-- html
|   |   |   |-- latex
|   |   |   |-- lite
|   |   |   |-- oddhtml
|   |   |   |-- oo
|   |   |   |-- p4
|   |   |   `-- relaxng
|   |   |-- enrich
|   |   |   |-- docx
|   |   |   |-- fo
|   |   |   |-- html
|   |   |   `-- latex
|   |   |-- iso
|   |   |   |-- docx
|   |   |   |   `-- model
|   |   |   |-- epub
|   |   |   |-- fo
|   |   |   |-- html
|   |   |   |-- latex
|   |   |   |-- schema
|   |   |   `-- tbx
|   |   |-- ota
|   |   |   |-- epub
|   |   |   `-- html
|   |   |-- oucs
|   |   |   |-- docx
|   |   |   |-- epub
|   |   |   `-- p4
|   |   |-- oucscourses
|   |   |   `-- docx
|   |   |-- podcasts
|   |   |   |-- docx
|   |   |   `-- epub
|   |   `-- tei
|   |       `-- epub
|   |-- slides
|   |-- slides2
|   |-- tite
|   |-- tools2
|   |-- xhtml
|   `-- xhtml2
`-- xquery

</eg>
There is a script in P5/Utilities/tei-install.sh which can be run to pull
the latest artefacts from Jenkins, and put them in the right place(s) on the TEI
web site. Usage is something like
<eg>
./tei-install.sh --package=TEIP5-Release --version=1.9.0
</eg>
ie where you specify the Jenkins package name, and the version number.
</p>
</div>

<div xml:id="roma">
<head>Setting up Roma and eXist</head>
<p>You thought it was easy so far?  Now we have to set up Roma and
eXist in tandem with the new data. </p>
<p>Roma needs access to XSLT stylesheets, P5 Relax NG schemas, and an
eXist database of TEI P5. Where it finds these is determined by the
file <code>roma/config.php</code> (on the web site, this is in the
<code>/usr/share/tei-roma/</code> directory). However, this varies between sites, so
what is distributed is <code>config-dist.php</code>. </p>

<p>How does TEI P5 get into eXist? Using the script <code>tei-database-rebuild</code>,
which is installed into <code>/usr/bin</code>. Running that on the TEI web site will,
with a following wind, do the right thing.</p>

</div>



    </body>
  </text>
</TEI>
